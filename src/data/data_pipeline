from src.data.download_data import download_pdfs
from src.data.build_embeddings import build_vector_store
import shutil
from pathlib import Path

def run_data_pipeline():
    """Orchestre l'ensemble du pipeline de vectorisation."""
    print("--- Démarrage du Pipeline de Vectorisation (CI/CD) ---")
    
    # 1. Téléchargement des données (depuis S3)
    download_pdfs()
    
    # 2. Nettoyage, Transformation, Embedding et Sauvegarde
    build_vector_store()
    
    # 3. Nettoyage : Supprimer le dossier temporaire des PDF
    temp_dir = Path("data/raw")
    if temp_dir.exists():
        shutil.rmtree(temp_dir)
        print("✅ Nettoyage des fichiers PDF temporaires réussi.")

    print("--- Pipeline de Vectorisation terminé avec succès ---")

if __name__ == "__main__":
    run_data_pipeline()
